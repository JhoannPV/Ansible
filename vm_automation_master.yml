---
# Playbook de inicio - configuraci√≥n autom√°tica de variables
- name: Setup Automatic VM Environment Configuration  
  hosts: localhost
  gather_facts: yes
  vars_files:
    - task_virtual_machines/env.yml
  vars:
    # Variables autom√°ticas usando valores por defecto del archivo de configuraci√≥n
    vm_base_directory: "{{ vm_base_directory_default }}"
    iso_base_directory: "{{ vm_iso_base_default }}"
    vm_iso_location: "{{ vm_iso_base_default }}/debian-13.1.0-amd64-netinst-custom.iso"

  tasks:
    - name: Display automation plan
      ansible.builtin.debug:
        msg:
          - "=== Automatizaci√≥n Completa de M√°quinas Virtuales ==="
          - "Este playbook ejecutar√° los siguientes pasos:"
          - "1. ‚úÖ Variables de entorno configuradas autom√°ticamente"
          - "2. Crear estructura de directorios autom√°ticamente"
          - "3. Crear ISO personalizada de Debian 13.1.0 (si no existe)"
          - "4. Configurar VirtualBox"
          - "5. Crear todas las VMs definidas en task_virtual_machines/env.yml"
          - ""
          - "Variables configuradas autom√°ticamente desde env.yml:"
          - "- VM Base Directory: {{ vm_base_directory }}"
          - "- ISO Base Directory: {{ iso_base_directory }}"
          - "- ISO Location: {{ vm_iso_location }}"
          - ""
          - "üéØ NO necesitas exportar variables manualmente"
          - "==========================================================="

# Paso 1: Crear ISO personalizada
- import_playbook: virtual_machines/create_custom_iso.yml

# Paso 2: Crear m√°quinas virtuales  
- import_playbook: virtual_machines/up_virtual_machine.yml

# Playbook final - muestra resumen de finalizaci√≥n
- name: Display Final Summary
  hosts: localhost
  gather_facts: no
  vars_files:
    - task_virtual_machines/env.yml
  vars:
    vm_base_directory: "{{ vm_base_directory_default }}"
    iso_base_directory: "{{ vm_iso_base_default }}"

  tasks:
    - name: Display final summary
      ansible.builtin.debug:
        msg:
          - "=== AUTOMATIZACI√ìN COMPLETADA ==="
          - "‚úÖ Variables de entorno configuradas autom√°ticamente"
          - "‚úÖ ISO personalizada creada en: {{ iso_base_directory }}"
          - "‚úÖ VirtualBox configurado"
          - "‚úÖ M√°quinas virtuales creadas en: {{ vm_base_directory }}"
          - ""
          - "Para gestionar las VMs:"
          - "- Listar VMs: VBoxManage list vms"
          - "- Iniciar VM: VBoxManage startvm 'NOMBRE-VM' --type headless"
          - "- Detener VM: VBoxManage controlvm 'NOMBRE-VM' poweroff"
          - ""
          - "Credenciales por defecto:"
          - "- Usuario: sysadmin"
          - "- Contrase√±a: admin123"
          - ""
          - "Configuraci√≥n completamente autom√°tica - Sin intervenci√≥n manual"
          - "==============================="